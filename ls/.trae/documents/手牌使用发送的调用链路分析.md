# 手牌使用发送的调用链路分析

## 1. 组件关系
- `index.vue`：游戏主页面，包含酒馆、战场和手牌三个区域
- `CardSlot.vue`：卡片插槽组件，用于显示单张卡片并处理交互

## 2. 核心调用链路

### 2.1 手牌选择 -> 放置到战场
```
CardSlot.vue:handleCardClick → 发射 card-select → index.vue:card-select → gameStore.selectCard → index.vue:handlePlaceAction → gameStore.placeMinionFromHand
```

### 2.2 手牌拖拽 -> 放置到战场
```
CardSlot.vue:start → 发射 drag-start → index.vue:handleDragStart → CardSlot.vue:end → 发射 card-move → index.vue:handleCardMove → gameStore.placeMinionFromHand
```

### 2.3 手牌法术使用
```
CardSlot.vue:start → 发射 drag-start → index.vue:handleDragStart → CardSlot.vue:end → 发射 spell-cast → 发射 card-remove → index.vue:handleCardRemove → gameStore.sellMinion
```

## 3. 关键函数和事件

### 3.1 CardSlot.vue
- `handleCardClick`：处理卡片点击，发射card-select事件
- `dragInteraction.draggable.listeners`：处理拖拽事件(start/move/end)
- `checkReleaseArea`：检查卡片释放区域
- `checkBattlefieldSlot`：检查战场槽位
- `highlightSpellTargets`：高亮法术目标

### 3.2 index.vue
- `handlePlaceAction`：处理放置卡片事件
- `handleCardMove`：处理卡片移动事件
- `handleCardRemove`：处理卡片移除事件
- `handleDragStart/End`：处理拖拽开始/结束事件

### 3.3 gameStore
- `selectCard`：选择卡片
- `placeMinionFromHand`：从手牌放置到战场
- `sellMinion`：出售卡片
- `moveCard`：移动卡片

## 4. 数据流向
1. 用户交互触发CardSlot.vue事件
2. 事件传递给index.vue进行处理
3. index.vue调用gameStore方法更新游戏状态
4. gameStore更新后，组件通过computed属性响应式更新UI

## 5. 法术使用特殊流程
1. 拖拽法术卡片时高亮可选择目标
2. 拖出手牌区域后显示法术箭头
3. 释放到有效目标时触发法术效果
4. 使用后从手牌移除法术卡片

## 6. 核心文件
- `d:\my_project\godot-compoent\ls\src\views\ls\components\CardSlot.vue`
- `d:\my_project\godot-compoent\ls\src\views\ls\index.vue`
- `d:\my_project\godot-compoent\ls\src\stores\game.ts` (间接调用)