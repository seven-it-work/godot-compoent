# 修仙文字游戏地点模块开发计划

## 1. 核心数据模型设计

### 1.1 地点数据模型

```typescript
interface Location {
  id: string; // 地点唯一标识
  x: number; // 横坐标
  y: number; // 纵坐标
  name: string; // 地点名称
  spiritQi: SpiritQi; // 灵气分布
  spiritVein?: SpiritVein; // 灵脉（可选）
  isCurrent: boolean; // 是否为当前地点
}
```

### 1.2 灵脉数据模型

```typescript
interface SpiritVein {
  type: SpiritRootType; // 灵脉类型
  productionSpeed: number; // 生产速度（单位时间生产的灵气量）
  level: number; // 灵脉等级
  name: string; // 灵脉名称
}
```

### 1.3 时间系统数据模型

```typescript
interface Location {
  id: string; // 地点唯一标识
  x: number; // 横坐标
  y: number; // 纵坐标
  name: string; // 地点名称
  spiritQi: SpiritQi; // 灵气分布
  spiritVein?: SpiritVein; // 灵脉（可选）
  isCurrent: boolean; // 是否为当前地点
}
```

### 1.4 地图数据模型

```typescript
interface GameMap {
  width: number; // 地图宽度（网格数）
  height: number; // 地图高度（网格数）
  locations: Location[][]; // 二维网格地点
}
```

## 2. 组件结构设计

### 2.1 地图组件 (`MapComponent.vue`)

- 显示2D网格地图

- 高亮当前地点

- 支持点击切换地点

- 显示地点的灵气和灵脉信息提示

### 2.2 地点信息组件 (`LocationInfo.vue`)

- 显示当前地点名称

- 显示当前地点的灵气分布

- 显示灵脉信息（如果有）

- 提供灵气吸收功能

### 2.3 时间显示组件 (`TimeDisplay.vue`)

- 显示当前游戏时间（年、月、日、时）

- 提供时间流速控制（暂停、1x、2x、4x）

### 2.4 外出系统组件 (`OutdoorSystem.vue`)

- 整合地图、地点信息和时间显示

- 提供返回修炼系统的功能

## 3. 核心逻辑设计

### 3.1 地图生成逻辑

1. 初始化地图网格
2. 随机生成地点名称
3. 随机分配灵气分布
4. 随机生成灵脉（概率性）
5. 设置初始当前地点

### 3.2 灵气吸收逻辑

1. 玩家在当前地点吸收灵气
2. 减少当前地点对应类型的灵气
3. 增加玩家对应类型的灵气
4. 检查地点灵气是否耗尽

### 3.3 灵脉生产逻辑

1. 根据时间流逝计算生产时间
2. 灵脉按照生产速度生产对应类型的灵气
3. 地点灵气不超过上限

### 3.4 时间系统逻辑

1. 时间自动流逝
2. 支持时间流速调整
3. 支持暂停/继续
4. 时间格式化显示

## 4. 状态管理设计

### 4.1 GameStore 扩展

- 添加 `map` 状态：存储地图数据

- 添加 `currentLocation` 状态：当前所在地点

- 添加 `gameTime` 状态：游戏时间

- 添加 `timeInterval` 状态：时间流逝定时器

### 4.2 Actions 设计

- `generateMap()`：生成地图

- `switchLocation(x, y)`：切换地点

- `absorbLocationSpiritQi(type)`：吸收地点灵气

- `produceSpiritQi()`：灵脉生产灵气

- `startTimeFlow()`：开始时间流逝

- `pauseTimeFlow()`：暂停时间流逝

- `setTimeSpeed(speed)`：设置时间流速

## 5. 开发步骤

### 5.1 第一步：扩展数据模型

- 在 `types/game.ts` 中添加地点、灵脉、时间系统相关类型

### 5.2 第二步：扩展状态管理

- 在 `gameStore.ts` 中添加地图、地点、时间相关状态和actions

### 5.3 第三步：开发时间系统

- 实现时间流逝逻辑

- 开发时间显示组件

### 5.4 第四步：开发地图组件

- 实现2D网格地图显示

- 实现地点切换功能

### 5.5 第五步：开发地点信息组件

- 显示地点灵气和灵脉信息

- 实现灵气吸收功能

### 5.6 第六步：开发外出系统组件

- 整合地图、地点信息和时间显示

- 实现系统切换功能

### 5.7 第七步：测试和优化

- 测试地图生成和地点切换

- 测试灵气吸收和灵脉生产

- 测试时间系统

- 优化UI和交互体验

## 6. 预期结果

- 玩家可以在外出系统中查看2D网格地图

- 玩家可以点击地图切换地点

- 玩家可以在当前地点吸收灵气，减少地点灵气

- 有灵脉的地点会自动生产对应灵气

- 游戏时间会自动流逝，支持流速调整

- 界面显示当前游戏时间和地点信息

## 7. 技术栈

- Vue 3 + TypeScript

- Ant Design Vue 组件库

- Pinia 状态管理

- CSS Grid/Flexbox 布局

- 定时器实现时间流逝

## 8. 后续扩展

- 添加地点探索功能

- 添加随机事件系统

- 添加怪物和战斗系统

- 添加资源采集系统
